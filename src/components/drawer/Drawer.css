/* Drawer Component - Modern glassmorphism design with smooth animations */

/* GLOBAL: Prevent pull-to-refresh when any drawer is active */
html {
  overscroll-behavior-y: auto; /* Default for normal browsing */
}

html.drawer-active {
  overscroll-behavior: none;
  -webkit-overscroll-behavior: none;
  overscroll-behavior-y: none;
  -webkit-overscroll-behavior-y: none;
}

/* Mobile viewport stability - address dynamic viewport changes */
@supports (height: 100dvh) {
  .drawer {
    height: 100dvh; /* Use dynamic viewport height when supported */
  }
}

/* Fallback for older browsers */
@supports not (height: 100dvh) {
  .drawer {
    height: 100vh;
    /* Fix iOS Safari viewport issues */
    height: calc(var(--vh, 1vh) * 100);
  }
}

.drawer {
  /* Only meaningful reusable variables */
  --panel-width: min(86vw, 420px);
  --panel-height: 75vh;
  --drawer-scale-x: 1;
  --drawer-scale-y: 1;

  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  z-index: 1050;
  display: block; /* Keep in DOM to allow transition from initial transform */
  pointer-events: none; /* Disabled until open */
  overflow: clip; /* Prevent any overflow issues and avoid scrollbars on transform */
}

.drawer--open {
  pointer-events: auto;
}

.drawer__backdrop {
  position: absolute;
  inset: 0;
  background: rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(12px) saturate(120%);
  -webkit-backdrop-filter: blur(12px) saturate(120%);
  opacity: 0;
  transition: opacity 0.3s ease-out;
}

.drawer--open .drawer__backdrop {
  opacity: 1;
}

.drawer__panel {
  position: absolute;
  background: #ffffff;
  color: #000000;
  border: 1px solid #E7E4EA;
  border-radius: 16px;
  box-shadow: 0 32px 64px rgba(0, 0, 0, 0.15),
              0 16px 32px rgba(0, 0, 0, 0.1),
              0 8px 16px rgba(0, 0, 0, 0.05);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
  padding: 1.25rem;
  /* Transition moved to separate rule */
  will-change: transform, opacity;
  overflow: hidden; /* Ensure panel doesn't cause page overflow */
  max-width: 100vw;
  max-height: 100vh;
  contain: layout paint size style; /* isolate for perf */
}

/* Dark mode support */
[data-theme="dark"] .drawer__panel {
  background: #17151B;
  border: 1px solid #17151B;
  color: #FAFAFA;
}

/* Sides with smooth drawer-like sliding */
.drawer--side-left .drawer__panel {
  inset-block: 0;
  inset-inline-start: 0;
  width: var(--panel-width);
  border-top-left-radius: 0;
  border-bottom-left-radius: 0;
  transform-origin: left center;
  transform: translate3d(-100%, 0, 0);
  opacity: 0;
}

.drawer--side-right .drawer__panel {
  inset-block: 0;
  inset-inline-end: 0;
  width: var(--panel-width);
  border-top-right-radius: 0;
  border-bottom-right-radius: 0;
  transform-origin: right center;
  transform: translate3d(100%, 0, 0);
  opacity: 0;
}

.drawer--side-top .drawer__panel {
  inset-inline: 0;
  inset-block-start: 0;
  height: var(--panel-height);
  border-top-left-radius: 0;
  border-top-right-radius: 0;
  transform-origin: center top;
  transform: translate3d(0, -100%, 0);
  opacity: 0;
}

.drawer--side-bottom .drawer__panel {
  inset-inline: 0;
  /* Use both modern and fallback positioning for mobile stability */
  inset-block-end: 0;
  bottom: calc(var(--drawer-bottom-offset, 0px) + env(safe-area-inset-bottom, 0px));
  height: var(--panel-height);
  border-bottom-left-radius: 0;
  border-bottom-right-radius: 0;
  transform-origin: center bottom;
  transform: translate3d(0, 100%, 0);
  opacity: 0;
  /* Mobile browser stability fixes */
  -webkit-backface-visibility: hidden;
  backface-visibility: hidden;
  /* Safari-specific positioning fix - combine with slide animation */
  -webkit-transform: translate3d(0, 100%, 0);
  transform: translate3d(0, 100%, 0);
  /* Force hardware acceleration and stability */
  will-change: transform, opacity, height;
  transform-style: preserve-3d;
}

.drawer__panel {
  /* Always have transition for smooth animations */
  transition: transform 0.45s cubic-bezier(0.22, 1, 0.36, 1),
              opacity 0.3s ease-out,
              height 0.45s cubic-bezier(0.22, 1, 0.36, 1),
              box-shadow 0.3s ease-out;
  will-change: transform, opacity, height;
  backface-visibility: hidden;
}



.drawer--open .drawer__panel {
  opacity: 1;
  transform: translate3d(0, 0, 0);
  box-shadow: 0 40px 80px rgba(0, 0, 0, 0.2),
              0 20px 40px rgba(0, 0, 0, 0.15),
              0 10px 20px rgba(0, 0, 0, 0.1);
}

/* Hover effects for interactive elements */
.drawer__panel:hover {
  box-shadow: 0 40px 80px rgba(0, 0, 0, 0.2),
              0 20px 40px rgba(0, 0, 0, 0.15),
              0 10px 20px rgba(0, 0, 0, 0.1);
}

/* Sizes (affect width/height depending on side) */
.drawer--size-s.drawer--side-left .drawer__panel,
.drawer--size-s.drawer--side-right .drawer__panel { width: min(78vw, 340px); }
.drawer--size-m.drawer--side-left .drawer__panel,
.drawer--size-m.drawer--side-right .drawer__panel { width: min(86vw, 420px); }
.drawer--size-l.drawer--side-left .drawer__panel,
.drawer--size-l.drawer--side-right .drawer__panel { width: min(92vw, 520px); }
.drawer--size-xl.drawer--side-left .drawer__panel,
.drawer--size-xl.drawer--side-right .drawer__panel { width: min(96vw, 680px); }

.drawer--size-s.drawer--side-top .drawer__panel,
.drawer--size-s.drawer--side-bottom .drawer__panel { height: 55vh; }
.drawer--size-m.drawer--side-top .drawer__panel,
.drawer--size-m.drawer--side-bottom .drawer__panel { height: 65vh; }
.drawer--size-l.drawer--side-top .drawer__panel,
.drawer--size-l.drawer--side-bottom .drawer__panel { height: 75vh; }
.drawer--size-xl.drawer--side-top .drawer__panel,
.drawer--size-xl.drawer--side-bottom .drawer__panel { height: 88vh; }

.drawer--fullscreen .drawer__panel {
  inset: 0;
  border-radius: 0;
}

.drawer__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.drawer__title { margin: 0; font-size: 1rem; line-height: 1.5rem; }
.drawer__description { margin: 0; color: #857798; font-size: 0.875rem; line-height: 1rem; }
.drawer__body {
  flex: 1 1 auto;
  min-height: 0;
  /* Ensure the body can shrink and enable scrolling */
  max-height: 100%;
  overflow: hidden;
  /* Smooth transition for content changes */
  transition: all 0.3s cubic-bezier(0.22, 1, 0.36, 1);
}

.drawer__body[data-scrollable="true"] {
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  /* Allow normal vertical scrolling */
  touch-action: pan-y;
  overscroll-behavior-y: contain; /* Prevent overscroll but allow scroll */
  /* Ensure scrolling works properly */
  height: 100%;
}

.drawer__body[data-scrollable="false"] {
  overflow: hidden;
  touch-action: none;
}

.drawer__footer {
  display: flex;
  justify-content: flex-end;
  gap: 0.5rem;
  /* keep footer visible at bottom of panel while body scrolls */
  margin-top: auto;
  position: sticky;
  bottom: 0;
  background: inherit;
  z-index: 2;
  /* safe-area padding */
  padding-bottom: calc(1rem + env(safe-area-inset-bottom, 0px));
}

/* ðŸ“± MOBILE OPTIMIZATION: Touch and overscroll behavior */

/* Different touch-action for different sides */
.drawer--side-left .drawer__panel,
.drawer--side-right .drawer__panel {
  touch-action: pan-y; /* Allow vertical scroll, capture horizontal drag */
  cursor: grab;
}

.drawer--side-top .drawer__panel,
.drawer--side-bottom .drawer__panel {
  touch-action: none; /* Capture all touch events for our drag logic */
  overscroll-behavior: none; /* Disable overscroll bounce on the panel */
  -webkit-overscroll-behavior: none; /* Safari/WebKit support */
  cursor: grab;
}

/* Allow content scrolling but prevent pull-to-refresh */
.drawer {
  overscroll-behavior: none;
  -webkit-overscroll-behavior: none;
}

/* Backdrop can disable touch since it's not content */
.drawer__backdrop {
  touch-action: none;
  overscroll-behavior: none;
  -webkit-overscroll-behavior: none;
}

.drawer__panel:active {
  cursor: grabbing;
}

/* ðŸ”¥ 3-MODE SYSTEM STYLES */

/* EXPANDED STATE: Full screen height */
.drawer--expanded.drawer--side-top .drawer__panel,
.drawer--expanded.drawer--side-bottom .drawer__panel {
  height: calc(100vh - 32px);
}

/* MINIMIZED STATE: Header only */
.drawer--minimized.drawer--side-bottom .drawer__panel {
  height: 80px;
  min-height: 80px;
  /* Ensure minimized drawer stays at bottom even when browser bars change */
  position: fixed !important;
  bottom: calc(var(--drawer-bottom-offset, 0px) + env(safe-area-inset-bottom, 0px)) !important;
  /* Safari-specific fixes for stable positioning */
  -webkit-transform: translateZ(0);
  transform: translateZ(0);
}

/* MINIMIZED STATE: Top drawer - Header only */
.drawer--minimized.drawer--side-top .drawer__panel {
  height: 80px;
  min-height: 80px;
  /* Ensure minimized drawer stays at top */
  position: fixed !important;
  top: 0 !important;
  /* Safari-specific fixes for stable positioning */
  -webkit-transform: translateZ(0);
  transform: translateZ(0);
}

/* CLOSING FROM MINIMIZED STATE: Proper directional sliding */
.drawer--closing-from-minimized.drawer--side-bottom .drawer__panel {
  transform: translate3d(0, 100%, 0) !important; /* Slide down */
  opacity: 0;
  transition: transform 0.45s cubic-bezier(0.22, 1, 0.36, 1),
              opacity 0.3s ease-out;
}

.drawer--closing-from-minimized.drawer--side-top .drawer__panel {
  transform: translate3d(0, -100%, 0) !important; /* Slide up */
  opacity: 0;
  transition: transform 0.45s cubic-bezier(0.22, 1, 0.36, 1),
              opacity 0.3s ease-out;
}

/* MINIMIZED STATE: Transparent backdrop and allow page interaction */
.drawer--minimized .drawer__backdrop {
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s ease-out;
}

.drawer--minimized {
  overflow: visible; /* Allow page scroll */
  pointer-events: none; /* Disable drawer interactions except panel */
}

.drawer--minimized .drawer__panel {
  pointer-events: auto; /* Re-enable panel interactions */
}

/* MINIMIZED STATE: Hide drawer body/footer content */
.drawer--minimized .drawer__body,
.drawer--minimized .drawer__footer {
  display: none;
}

/* Disable overscroll on entire page when drawer is active (not minimized) */
body.drawer-active-not-minimized {
  overscroll-behavior: none;
  -webkit-overscroll-behavior: none;
  /* Prevent pull-to-refresh without breaking scroll position */
  overscroll-behavior-y: none;
  -webkit-overscroll-behavior-y: none;
}

/* ðŸ”¥ DISABLE ALL transitions during drag for real-time response */
.drawer[data-dragging="true"] .drawer__panel {
  transition: none !important;
  will-change: transform, height;
  backface-visibility: hidden;
  transform-style: preserve-3d;
  /* Prevent jumping during elongation effect */
  transform-box: border-box;
  /* ðŸš€ Force GPU layer isolation during drag */
  isolation: isolate;
}

/* ðŸš€ Optimize backdrop during drag - reduce blur computation */
.drawer[data-dragging="true"] .drawer__backdrop {
  transition: none !important;
  /* Reduce blur during drag for better performance */
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
}

/* Ensure header remains interactive in minimized mode */
.drawer--minimized .drawer__header {
  cursor: grab;
  touch-action: none;
  user-select: none;
}

.drawer--minimized .drawer__header:active {
  cursor: grabbing;
}

/* Ensure initial translate-from-side animation is preserved */
.drawer--side-left .drawer__panel,
.drawer--side-right .drawer__panel,
.drawer--side-top .drawer__panel,
.drawer--side-bottom .drawer__panel {
  will-change: transform, opacity;
}

/* Ensure content remains clickable */
.drawer__panel > *:not(.drawer__drag-indicator) {
  pointer-events: auto;
  position: relative;
  z-index: 10;
}

/* Wrong direction drag feedback - subtle visual cue */
/* Removed wrong-direction feedback at start to prevent flicker on first touch */

/* Drag indicator - shows progress and direction */
.drawer__drag-indicator {
  position: absolute;
  z-index: 10;
  pointer-events: none;

  /* Base styles for all sides */
  background: #27222D;
  border-radius: 9999px;
}

/* Drag indicator positioning by side */
.drawer__drag-indicator[data-side="left"] {
  top: 50%;
  right: -0.5rem;
  width: 4px;
  height: 86px;
  transform: translateY(-50%);
}

.drawer__drag-indicator[data-side="right"] {
  top: 50%;
  left: -0.5rem;
  width: 4px;
  height: 86px;
  transform: translateY(-50%);
}

.drawer__drag-indicator[data-side="top"] {
  bottom: -0.5rem;
  left: 50%;
  width: 86px;
  height: 4px;
  transform: translateX(-50%);
}

.drawer__drag-indicator[data-side="bottom"] {
  top: -0.5rem;
  left: 50%;
  width: 86px;
  height: 4px;
  transform: translateX(-50%);
}

/* Progress bar within indicator */
.drawer__drag-progress {
  position: absolute;
  background: #6F4EF2;
  border-radius: inherit;
  transition: color 0.15s cubic-bezier(0.4, 0, 0.2, 1), background-color 0.15s cubic-bezier(0.4, 0, 0.2, 1), border-color 0.15s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 0 8px rgba(59, 130, 246, 0.4);

  /* Pulsing effect based on resistance */
  animation: dragPulse 0.3s ease-in-out infinite alternate;
}

/* Progress direction by side */
.drawer__drag-indicator[data-side="left"] .drawer__drag-progress,
.drawer__drag-indicator[data-side="right"] .drawer__drag-progress {
  bottom: 0;
  left: 0;
  right: 0;
  height: var(--progress, 0%);
}

.drawer__drag-indicator[data-side="top"] .drawer__drag-progress,
.drawer__drag-indicator[data-side="bottom"] .drawer__drag-progress {
  left: 0;
  top: 0;
  bottom: 0;
  width: var(--progress, 0%);
}

@keyframes dragPulse {
  from {
    opacity: 0.6;
    transform: scale(1);
  }
  to {
    opacity: 1;
    transform: scale(calc(1 + (1 - var(--resistance, 1)) * 0.2));
  }
}

/* Add subtle animations to header elements */
.drawer__header {
  border-bottom: 1px solid rgba(0, 0, 0, 0.08);
  padding-bottom: 0.75rem;
  margin-bottom: 1rem;
}

[data-theme="dark"] .drawer__header {
  border-bottom-color: rgba(255, 255, 255, 0.1);
}

[data-theme="dark"] .drawer__description {
  color: #857798;
}

.drawer__title {
  font-weight: 600;
  letter-spacing: -0.025em;
}

.drawer__description {
  margin-top: 0.25rem;
}

.drawer__footer {
  border-top: 1px solid rgba(0, 0, 0, 0.08);
  padding-top: 1rem;
  margin-top: 1rem;
}

/* Smooth entrance animation with stagger */
.drawer--open .drawer__header {
  animation: slideInFade 0.3s cubic-bezier(0.25, 0.1, 0.25, 1) 0.15s both;
}

.drawer--open .drawer__body {
  animation: slideInFade 0.3s cubic-bezier(0.25, 0.1, 0.25, 1) 0.2s both;
}

.drawer--open .drawer__footer {
  animation: slideInFade 0.3s cubic-bezier(0.25, 0.1, 0.25, 1) 0.25s both;
}

@keyframes slideInFade {
  from {
    opacity: 0;
    transform: translateY(4px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce) {
  .drawer__backdrop, .drawer__panel { transition: none; }
}